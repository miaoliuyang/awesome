#### 7.1 z-index只是CSS层叠规则中的一叶小舟
在CSS世界中, z-index属性只有和定位元素(position不为static的元素)在一起的时候才有作用。可以是正数也可以是负数。随着CSS3世界的到来,z-index已经并非只对定位元素有效,flex盒子的子元素也可以设置z-index属性。

网页中绝大部分元素是非定位元素,并且影响层叠顺序的属性远不止z-index一个。

#### 7.2 层叠上下文和层叠水平
##### 7.2.1 层叠上下文(stacking context)
如果一个元素含有层叠上下文,可以理解为这个元素在z轴上就高人一等。

我们可以把层叠上下文理解为一种"层叠结界",自成一个小世界。这个小世界中可能有其他的"层叠结界",而自身也可能处于其他"层叠结界"中
##### 7.2.2 层叠水平(stacking level)
层叠水平决定了同一个层叠上下文中元素在z轴上的显示顺序。

所有的元素都有层叠水平,包括层叠上下文元素,也包括普通元素。然而对普通元素的层叠水平探讨只局限在当前层叠上下文元素中。

不要把层叠水平和z-index属性混为一谈。尽管有些情况下z-index确实可以影响层叠水平,但是只限于定位元素以及flex盒子的子元素;而层叠水平所有的元素都存在。

#### 7.3 层叠顺序(stacking order)
层叠顺序表示元素发生层叠时的特定垂直显示顺序。在CSS2.1的年代,在CSS3新世界还没到来的时候,层叠顺序规则如下：

层叠上下文background/color -> 复z-index -> block块状水平盒子 -> float浮动盒子 -> inline水平盒子 -> z-index:auto或z-index:0 不依赖z-index的层叠上下文 -> 正z-index

(1)位于最下面的background/color特指层叠上下文元素的边框和背景色。每一个层叠规则顺序仅适用于当前层叠上下文元素的小世界。

(2)inline水平盒子指的是包括inline/inline-block/inline-table元素的层叠顺序,它们都是同等级别的。

(3)单纯从层叠水平上看,实际上z-index:0和z-index:auto是可以看成是一样的。"单纯从层叠水平上看",实际上,两者在层叠上下文领域有根本性的差异。

#### 7.4 层叠准则
当元素发生层叠的时候,其覆盖规则遵循下面两条准则:

(1)谁大谁上: 当具有明显的层叠水平标识的时候,如生效的z-index属性值,在同一个层叠上下文领域,层叠水平值大的一个覆盖小的那一个。

(2)后来居上: 当元素的层叠水平一致,层叠顺序相同的时候,在DOM流中处于后面的元素会覆盖前面的元素。

##### 7.5深入了解层叠上下文
##### 7.5.1 层叠上下文的特性
- 层叠上下文的层叠水平要比普通元素高
- 层叠上下文可以阻断元素的混合模式
- 层叠上下文可以嵌套,内部层叠上下文以及所有子元素均受制于外部的"层叠上下文"
- 每个层叠上下文和兄弟元素独立,当进行层叠变化或渲染的时候,只需要考虑后代元素
- 每个层叠上下文是自成体系的,当元素发生层叠的时候,整个元素被认为是在父层叠上下文的层叠顺序中。

##### 7.5.2 层叠上下文的创建
(1)天生派: 页面根元素天生具有层叠上下文, 成为根层叠上下文

(2)正统派: z-index值为数组的定位元素的传统"层叠上下文"

(3)扩招派: 其他CSS3属性

1.根层叠上下文

2.定位元素与传统层叠上下文

对于position值为relative/absolute以及firefox/ie浏览器(不包括chrome浏览器)下含有position:fixed声明的定位元素,当其z-index值不是auto(哪怕是0)的时候,会创建层叠上下文。

http://demo.cssworld.cn/7/5-1.php

在过去position:fixed和relative/absolute在层叠上下文这一块是一样的,都需要z-index为数值才行。但是不知道什么时候起,chrome等webkit内核浏览器下,position:fixed元素天然层叠上下文元素,无效z-index为数值。

3.CSS3与新时代的层叠上下文

(1)元素为flex布局元素(父元素display:flex|inline-flex)同时z-index值不是auto

(2)元素的opacity值不是1

(3)元素的transform值不是none

(4)元素的mix-blend-mode值不是normal

(5)元素的filter值不是none

(6)元素的isolation值是isolate

(7)元素的will-change属性值为上面2~6的任意一个

(8)元素的-webkit-overflow-scrolling设为touch

##### 7.5.3 层叠上下文与层叠顺序

一旦普通元素具有了层叠上下文,其层叠顺序就会变高。

